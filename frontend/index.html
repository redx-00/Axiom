<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GSS Terminal</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #000;
    color: #fff; /* default white text */
    font-family: monospace;
    height: 100%;
    overflow: hidden;
  }
  #screen {
    box-sizing: border-box;
    padding: 8px;
    height: 100%;
    overflow-y: auto;
    white-space: pre-wrap;
  }
  #input-line {
    display: flex;
  }
  #prompt {
    flex: 0 0 auto;
  }
  #cmd {
    flex: 1 1 auto;
    background: transparent;
    border: none;
    color: #fff;
    font-family: monospace;
    outline: none;
  }
  #file-input, #gpkg-input {
    display: none;
  }
</style>
</head>
<body>
<div id="screen"></div>
<input id="file-input" type="file" accept=".gss" />
<input id="gpkg-input" type="file" accept=".gpkg" />
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script type="module">
import { createTerminal } from './js/core/terminal.js';
import { createGssManager } from './js/core/gss.js';
import { createBackend } from './js/core/backend.js';
import { createProgramLoader } from './js/core/programLoader.js';
import { createEventBus } from './js/core/eventBus.js';
import { installCorePrograms } from './js/programs/print.js';
import { installFsProgram } from './js/programs/fs.js';
import { installHttpsProgram } from './js/programs/https.js';
import { installProgramManager } from './js/programs/programManager.js';
import { installChatRuntime } from './js/programs/chatRuntime.js';

const BACKEND_BASE = "https://gss-message-bus.yourname.workers.dev"; // set this

const screen = document.getElementById("screen");
const fileInput = document.getElementById("file-input");
const gpkgInput = document.getElementById("gpkg-input");

const eventBus = createEventBus();
const backend = createBackend(BACKEND_BASE);
const gssManager = createGssManager(JSZip, fileInput);
const programLoader = createProgramLoader(JSZip, gssManager, eventBus, backend);
const terminal = createTerminal(screen, eventBus, gssManager, programLoader, backend, gpkgInput);

// install built-in JS programs (not .gpkg): print, fs, https, program manager, chat runtime
installCorePrograms(eventBus, terminal);
installFsProgram(eventBus, terminal, gssManager);
installHttpsProgram(eventBus, backend, terminal);
installProgramManager(eventBus, terminal, gssManager, programLoader, gpkgInput);
installChatRuntime(eventBus, backend, gssManager, terminal);

terminal.print("GSS Terminal");
terminal.print("Text is white by default. Colors are supported.");
terminal.print("Use 'loadgss' to load a .gss, or 'newgss' to create one.");
terminal.showPrompt();
</script>
</body>
</html>
