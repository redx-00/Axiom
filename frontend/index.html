<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GSS Terminal</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #000;
    color: #fff;
    font-family: monospace;
    height: 100%;
    overflow: hidden;
  }
  #screen {
    box-sizing: border-box;
    padding: 8px;
    height: 100%;
    overflow-y: auto;
    white-space: pre-wrap;
  }
  #input-line {
    display: flex;
  }
  #prompt {
    flex: 0 0 auto;
  }
  #cmd {
    flex: 1 1 auto;
    background: transparent;
    border: none;
    color: #fff;
    font-family: monospace;
    outline: none;
  }
  #file-input, #gpkg-input {
    display: none;
  }
</style>
</head>
<body>
<div id="screen"></div>
<input id="file-input" type="file" accept=".gss" />
<input id="gpkg-input" type="file" accept=".gpkg" />
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script type="module">
import { createTerminal } from './js/core/terminal.js';
import { createGssManager } from './js/core/gss.js';
import { createBackend } from './js/core/backend.js';
import { createEventBus } from './js/core/eventBus.js';
import { createProgramLoader } from './js/core/programLoader.js';

import { installPrintProgram } from './js/programs/print.js';
import { installFsProgram } from './js/programs/fs.js';
import { installHttpsProgram } from './js/programs/https.js';
import { installProgProgram } from './js/programs/prog.js';
import { installRequestsRuntime } from './js/programs/requestsRuntime.js';

const BACKEND_BASE = "https://axiomworkers.a-villa232925.workers.dev/"; // set this

const screen = document.getElementById("screen");
const fileInput = document.getElementById("file-input");
const gpkgInput = document.getElementById("gpkg-input");

const eventBus = createEventBus();
const backend = createBackend(BACKEND_BASE);
const gssManager = createGssManager(JSZip, fileInput);
const programLoader = createProgramLoader(JSZip, gssManager, eventBus, backend);
const terminal = createTerminal(screen, eventBus, gssManager, programLoader);

installPrintProgram(eventBus, terminal);
installFsProgram(eventBus, terminal, gssManager);
installHttpsProgram(eventBus, backend, terminal);
installProgProgram(eventBus, terminal, gssManager, programLoader, gpkgInput);
installRequestsRuntime(eventBus, backend, gssManager, terminal);

function banner() {
  const meta = gssManager.getMeta();
  const user = meta?.username || "unknown";
  const ip = meta?.fakeIp || "0.0.0.0";
  const oobe = meta?.oobeDone ? "Completed" : "Pending";

  terminal.print("──────────────────────────────────────────────");
  terminal.print("   GSS TERMINAL — LOCAL WORLD ENVIRONMENT");
  terminal.print("──────────────────────────────────────────────");
  terminal.print(`User: ${user}    IP: ${ip}`);
  terminal.print(`OOBE: ${oobe}`);
  terminal.print("");
  terminal.print("Type 'help' for commands.");
  terminal.print("Type 'prog list' to see editable programs.");
  terminal.print("Type 'programs' to see installed .gpkg packages.");
  terminal.print("──────────────────────────────────────────────");
  terminal.print("");
}

banner();
terminal.showPrompt();
</script>
</body>
</html>
